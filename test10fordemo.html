<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Parallax Exploration Page</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      width: 100%;
      height: 100%;
      background: #000;
    }

    .layer {
      position: absolute;
      top: 0;
      left: 0;
      background-position: top left;
      background-size: cover;
      pointer-events: none;
    }

    #background {
      background-image: url('background1.jpg');
      z-index: 1;
    }

    #foreground {
      background-image: url('foreground1.png');
      background-repeat: repeat-x;
      background-size: auto 488px;
      height: 488px;
      width: 1200%;
      position: absolute;
      bottom: -300px; /* start mostly off-screen */
      left: 0;
      z-index: 3;
      pointer-events: none;
    }

    .clickable {
      position: absolute;
      width: 80px;
      height: 80px;
      background-size: contain;
      background-repeat: no-repeat;
      cursor: pointer;
      z-index: 4;
      transition: transform 0.3s ease, filter 0.3s ease;
    }

    /* TEST ONLY: Hover styling — delete when finished testing */
    .clickable:hover {
      transform: scale(1.1);
      filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.4));
    }

    /* TEST ONLY: Visual borders for clickable regions — delete when finished testing */
    .clickable {
      outline: 2px dashed rgba(255, 255, 255, 0.3);
    }

    #fadeOverlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: black;
      opacity: 0;
      pointer-events: none;
      transition: opacity 1s ease;
      z-index: 10;
    }

    #textBox {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 10px 20px;
      border-radius: 10px;
      font-family: sans-serif;
      opacity: 0;
      transition: opacity 0.5s ease;
      z-index: 11;
    }
  </style>
</head>
<body>
  <audio id="ambientAudio" src="ambient.mp3" autoplay loop></audio>

  <div id="background" class="layer"></div>
  <div id="foreground" class="layer"></div>

  <!-- Example clickable spots -->
  <div class="clickable" id="click1" style="top: 40%; left: 60%; background-image: url('icon_text.jpg');"></div>
  <div class="clickable" id="click2" style="top: 55%; left: 30%; background-image: url('icon_sound.jpg');"></div>
  <div class="clickable" id="click3" style="top: 65%; left: 70%; background-image: url('icon_portal.jpg');"></div>
  <div class="clickable" id="click4" style="top: 50%; left: 45%; background-image: url('icon_anim.jpg');"></div>

  <!-- New world-locked clickable examples -->
  <div class="clickable" id="clickCorner" style="background-image: url('icon_corner.jpg');"></div>
  <div class="clickable" id="clickBGCenter" style="background-image: url('icon_bgcenter.jpg');"></div>
  <div class="clickable" id="clickFGCenter" style="background-image: url('icon_fgcenter.jpg');"></div>

  <div id="fadeOverlay"></div>
  <div id="textBox"></div>

  <script>
    const bg = document.getElementById('background');
    const fg = document.getElementById('foreground');
    const fadeOverlay = document.getElementById('fadeOverlay');
    const textBox = document.getElementById('textBox');

    const corner = document.getElementById('clickCorner');
    const bgCenter = document.getElementById('clickBGCenter');
    const fgCenter = document.getElementById('clickFGCenter');

    let targetX = 0, targetY = 0;
    let currentX = 0, currentY = 0;

    const bgWidth = 7932;
    const bgHeight = 2651;

    function resizeLayers() {
      bg.style.width = `${bgWidth}px`;
      bg.style.height = `${bgHeight}px`;
    }

    resizeLayers();

    document.addEventListener('mousemove', (e) => {
      const xRatio = e.clientX / window.innerWidth;
      const yRatio = e.clientY / window.innerHeight;
      targetX = xRatio;
      targetY = yRatio;
    });

    function isInViewport(el) {
      const rect = el.getBoundingClientRect();
      return (
        rect.top < window.innerHeight &&
        rect.bottom > 0 &&
        rect.left < window.innerWidth &&
        rect.right > 0
      );
    }

    function animate() {
      // Smooth subtle lag motion
      currentX += (targetX - currentX) * 0.05;
      currentY += (targetY - currentY) * 0.05;

      const maxOffsetX = bgWidth - window.innerWidth;
      const maxOffsetY = bgHeight - window.innerHeight;

      // Background covers full image range
      const bgX = -currentX * maxOffsetX;
      const bgY = -currentY * maxOffsetY;

      // Foreground moves faster but mostly off-screen below
      const fgX = -currentX * (maxOffsetX * 1.8);
      const fgY = 700 + currentY * -400; // hides faster when moving mouse upward
      fg.style.transform = `translate(${fgX}px, ${fgY}px)`;

      bg.style.transform = `translate(${bgX}px, ${bgY}px)`;

      // World-locked positions
      // Corner locked to upper-right of background
      const cornerX = bgWidth - 200;
      const cornerY = 200;
      corner.style.transform = `translate(${bgX + cornerX}px, ${bgY + cornerY}px)`;

      // Background center locked clickable
      const bgCenterX = bgWidth / 2 - 40;
      const bgCenterY = bgHeight / 2 - 40;
      bgCenter.style.transform = `translate(${bgX + bgCenterX}px, ${bgY + bgCenterY}px)`;

      // Foreground center locked clickable (moves with fence)
      const fgCenterX = window.innerWidth / 2 - 40;
      const fgCenterY = window.innerHeight - 240;
      fgCenter.style.transform = `translate(${fgX + fgCenterX}px, ${fgY + fgCenterY}px)`;

      // Enable clicks only when visible
      [corner, bgCenter, fgCenter].forEach(el => {
        el.style.pointerEvents = isInViewport(el) ? 'auto' : 'none';
      });

      requestAnimationFrame(animate);
    }

    animate();

    function fadeTransition(callback, nextPage = null) {
      fadeOverlay.style.pointerEvents = 'auto';
      fadeOverlay.style.opacity = 1;
      setTimeout(() => {
        if (callback) callback();
        if (nextPage) window.location.href = nextPage;
      }, 1000);
    }

    function showText(message) {
      textBox.textContent = message;
      textBox.style.opacity = 1;
      setTimeout(() => {
        textBox.style.opacity = 0;
      }, 3000);
    }

    const clickSound = new Audio('click.mp3');

    document.getElementById('click1').addEventListener('click', () => {
      showText('You discovered something strange...');
      clickSound.play();
    });

    document.getElementById('click2').addEventListener('click', () => {
      showText('A distant echo whispers your name.');
      clickSound.play();
    });

    document.getElementById('click4').addEventListener('click', () => {
      showText('Something stirs in the shadows...');
      clickSound.play();
    });

    document.getElementById('click3').addEventListener('click', () => {
      clickSound.play();
      fadeTransition(() => {
        showText('The air feels colder here...');
      }, 'nextpage.html');
    });

    // New world-locked clickable messages
    corner.addEventListener('click', () => {
      showText('You reached the farthest point to the north...');
      clickSound.play();
    });

    bgCenter.addEventListener('click', () => {
      showText('Something powerful resonates at the heart of this world.');
      clickSound.play();
    });

    fgCenter.addEventListener('click', () => {
      showText('The fence conceals a secret right in front of you...');
      clickSound.play();
    });

    // TEST ONLY: Hover & border test (safe to delete later)
    console.log('Hover glow, scale, and dashed border test active. Remove marked TEST ONLY CSS and this console log when finished testing.');
  </script>
</body>
</html>